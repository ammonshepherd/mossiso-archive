{"id":1081,"date":"2011-09-27T10:28:10","date_gmt":"2011-09-27T14:28:10","guid":{"rendered":"http:\/\/mossiso.com\/?p=1081"},"modified":"2014-09-22T15:12:32","modified_gmt":"2014-09-22T19:12:32","slug":"making-smf-static","status":"publish","type":"post","link":"https:\/\/mossiso.com\/2011\/09\/27\/making-smf-static\/","title":{"rendered":"Making SMF static"},"content":{"rendered":"<p><a href=\"http:\/\/www.simplemachines.org\/\"><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter size-full wp-image-1113\" title=\"frontpage_logo\" src=\"http:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/frontpage_logo.png\" alt=\"\" width=\"486\" height=\"65\" srcset=\"https:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/frontpage_logo.png 486w, https:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/frontpage_logo-300x40.png 300w, https:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/frontpage_logo-250x33.png 250w, https:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/frontpage_logo-150x20.png 150w\" sizes=\"(max-width: 486px) 100vw, 486px\" \/><\/a>We have a few legacy forums powered by the good software SMF (<a title=\"http:\/\/www.simplemachines.org\/\" href=\"http:\/\/www.simplemachines.org\/\">SimpleMachines Forum<\/a>). Like many of the WordPress installs, it&#8217;s a pain and a security risk to keep these up-to-date when they are no longer needed as content creation platforms. So, once again I need to convert a web app into static HTML pages. This process proved a bit harder than converting WordPress to static HTML.<\/p>\n<h2><strong>Step 1: Upgrade<\/strong><\/h2>\n<p>The first thing to do is update to the latest version. This ensures that if you need to turn this back into a dynamic site, it should hopefully be compatible with whatever the latest version is at that time.<\/p>\n<h2><strong>Step 2: Make it public<\/strong><\/h2>\n<p>Next, we&#8217;ll need to make it public to guests, so that wget has access to the pages.<\/p>\n<p>Go to the Admin-&gt;Features and Options page and check the &#8220;Allow guests to browse the forum&#8221; box, then click save. Now we have to change the permissions on each board separately. Or with a bit of MySQL magic, we can change them all at once using the CONCAT operator. Open of phpMyAdmin, or something else of your choice. Before we mess with the data, make a copy of the table, just in case we totally hose it.<\/p>\n<p>Browse to the &#8216;boards&#8217; table, and then to the SQL tab. We&#8217;re going to enter an SQL command that will pre-pend (that&#8217;s append but onto the front rather than the end) some data.<\/p>\n<pre class=\"lang:mysql decode:true \">UPDATE boards SET member_groups=CONCAT('-1,', member_groups) WHERE 1<\/pre>\n<p>&nbsp;<\/p>\n<p>This will add a -1, to the beginning of each field, which makes the board viewable by guests. No need to log in, which means wget can scrape the pages and turn them into HTML.<\/p>\n<h2><strong>Step 3: Edit Theme files<\/strong><\/h2>\n<p>Now we get to play around with the theme files to get rid of forum specific items that we won&#8217;t need, like links to member info, the login, help, and search links, and anything else that we don&#8217;t want.<\/p>\n<p>Here are some items to delete or alter, and the files I found them in for our home-made theme based off of an old default theme.<\/p>\n<h4><strong>index.template.php<\/strong><\/h4>\n<ul>\n<li>Add a title<\/li>\n<li>Get rid of date stamp<\/li>\n<li>Get rid of the main menu (Home, Help, Search, Login, etc)<\/li>\n<\/ul>\n<h4>BoardIndex.template.php<\/h4>\n<ul>\n<li>Search for [&#8216;member&#8217;][&#8216;link&#8217;] and change it to [&#8216;member&#8217;][&#8216;name&#8217;] This will take out all links to member profile pages.<\/li>\n<\/ul>\n<h4>Display.template.php<\/h4>\n<ul>\n<li>Search for [&#8216;member&#8217;][&#8216;link&#8217;] and change it to [&#8216;member&#8217;][&#8216;name&#8217;] This will take out all links to member profile pages.<\/li>\n<li>Get rid of the drop down menu to select pages.<\/li>\n<\/ul>\n<h4>MessageIndex.template.php<\/h4>\n<ul>\n<li>Search for [&#8216;member&#8217;][&#8216;link&#8217;] and change it to [&#8216;member&#8217;][&#8216;name&#8217;] This will take out all links to member profile pages.<\/li>\n<li>Delete the &#8216;Jump to&#8217; drop-down box and the icons explaining post\/board types<\/li>\n<\/ul>\n<h2><strong>Step 4: Fix the URLs<\/strong><\/h2>\n<p>As it stands, SMF has some pretty ugly URLs. There are a couple of mods that I could never get to work. But editing a file and adding an .htaccess file seems to do the trick.<\/p>\n<p>Open the Sources\/QueryString.php file and look for the line like this:<\/p>\n<pre class=\"lang:php decode:true \">$scripturl = $boardurl . '\/index.php';<\/pre>\n<p>and get rid of the \/index.php<\/p>\n<p>Now create a .htaccess file in the root of the forum (in the same folder as the Settings.php file). It should look similar to this:<\/p>\n<pre class=\"lang:apache decode:true \">RewriteEngine On\r\nRewriteBase \/7tah\/forum\/\r\nRewriteCond %{REQUEST_FILENAME} !-f\r\nRewriteCond %{REQUEST_FILENAME} !-d\r\nRewriteRule . \/7tah\/forum\/index.php [L]<\/pre>\n<p>&nbsp;<\/p>\n<h2>Step 5: Wget it<\/h2>\n<p>Now we run wget on the command line to grab the pages.<\/p>\n<pre class=\"lang:sh decode:true\">wget --mirror -P static-forum -nH -np -p -k -E --cut-dirs=2 http:\/\/domain.com\/path\/forum\/<\/pre>\n<p>All of the static HTML files will now be located in a directory called static-forum.<\/p>\n<h2>Step 6: Fix filenames<\/h2>\n<p>Some filenames will be a bit broken. Specifically the style.css has an extra &#8220;?fin11&#8221; in the html files where the file is called. Also, it get&#8217;s name that way. So fix that by changing the name of the file to just style.css (it&#8217;s in your Theme directory). Then run this one-line command to search and replace throughout all of the static html files (run the command when you are in the static-forum directory.<\/p>\n<pre class=\"lang:sh decode:true \">find . -name '*.html' -type f -exec perl -pi -e 's\/style.css%3Ffin11\/style.css\/g' {} \\;<\/pre>\n<p>&nbsp;<\/p>\n<p>This will look for all of the references to the style.css%3Ffin11 file and change them to style.css. Then the pretty colors and formatting will work. Just for clarification, the %3F is code for a question mark. It shows up as such in the HTML source when viewing from a browser, but is displayed as such in the actual code.<\/p>\n<p>Don&#8217;t forget to change the the actual name of the css file to style.css.<\/p>\n<h2>Step 7: Protect it<\/h2>\n<p>Depending on\u00a0 your needs, you may want to password protect your new static forum with an htaccess account. The good peoples at <a title=\"htaccess password tool\" href=\"http:\/\/tools.dynamicdrive.com\/password\/\" target=\"_blank\">Dynamic Drive have an helpful tool<\/a> for making the two files necessary to make this happen. Just plug in your desired user name, password, and location of the htpasswd file, and then it&#8217;s copy and paste into those files on the server.<\/p>\n<p>I change the last line of the htaccess file to <code>require user username<\/code> so that it works only with the given user, not any valid. But since it only pulls from the specified htpasswd file, it&#8217;s kind of pointless.<\/p>\n<h2>Step 8: Backup the old<\/h2>\n<p>It&#8217;s a good idea to make a backup of the database and site files before getting rid of them. I just make a mysqldump of the database, throw it in the forum folder, and then make a tar or zip file of that and put the file in the new static forum folder for safe keeping.<\/p>\n<h2>Step 9: That&#8217;s it.<\/h2>\n<p>Sit back and relax. Your forum is interactive no longer.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>We have a few legacy forums powered by the good software SMF (SimpleMachines Forum). Like many of the WordPress installs, it&#8217;s a pain and a security risk to keep these up-to-date when they are no longer needed as content creation platforms. So, once again I need to convert a web app into static HTML pages. &hellip; <a href=\"https:\/\/mossiso.com\/2011\/09\/27\/making-smf-static\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">Making SMF static<\/span><\/a><\/p>\n","protected":false},"author":1,"featured_media":1111,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"jetpack_post_was_ever_published":false,"_jetpack_newsletter_access":"","_jetpack_dont_email_post_to_subs":false,"_jetpack_newsletter_tier_id":0,"footnotes":"","jetpack_publicize_message":"","jetpack_publicize_feature_enabled":true,"jetpack_social_post_already_shared":false,"jetpack_social_options":{"image_generator_settings":{"template":"highway","enabled":false}}},"categories":[3,167],"tags":[222,179,223],"class_list":["post-1081","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","category-coding","category-technical","tag-linux","tag-servers","tag-systems-administration"],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"https:\/\/mossiso.com\/wp-content\/uploads\/2011\/09\/Screen-Shot-2011-09-27-at-Sep-27-10.18.02-AM-e1317133813359.png","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/p9wosP-hr","_links":{"self":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1081"}],"collection":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/comments?post=1081"}],"version-history":[{"count":37,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1081\/revisions"}],"predecessor-version":[{"id":1655,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1081\/revisions\/1655"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/media\/1111"}],"wp:attachment":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/media?parent=1081"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/categories?post=1081"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/tags?post=1081"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}