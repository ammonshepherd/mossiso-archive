{"id":1342,"date":"2012-10-11T15:01:50","date_gmt":"2012-10-11T19:01:50","guid":{"rendered":"http:\/\/mossiso.com\/?p=1342"},"modified":"2014-09-22T14:09:12","modified_gmt":"2014-09-22T18:09:12","slug":"when-your-os-updates-break-your-cam","status":"publish","type":"post","link":"https:\/\/mossiso.com\/2012\/10\/11\/when-your-os-updates-break-your-cam\/","title":{"rendered":"When  your OS updates break your CAM"},"content":{"rendered":"<p>As I&#8217;m sure many people have run into this before, and from personal experience, found nothing roaming the Interwebs on how to fix it, and seeings how I just fixed it, I&#8217;ll write up a little how to fix it post.<\/p>\n<p>&nbsp;<\/p>\n<h3>The set up:<\/h3>\n<p>Two SunFire X2100 M2 servers connected to a StorageTek 2530 via iscsi. The two nodes are running CentOS 6.2 with RedHat cluster software. I have a server running Nagios for monitoring and it checks for failed disks on the StorageTek by running a script on either node that returns the number of &#8220;optimal&#8221; and &#8220;failed&#8221; disks.<\/p>\n<p>&nbsp;<\/p>\n<figure id=\"attachment_1343\" aria-describedby=\"caption-attachment-1343\" style=\"width: 490px\" class=\"wp-caption aligncenter\"><a href=\"http:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM.png\"><img loading=\"lazy\" decoding=\"async\" class=\"size-full wp-image-1343\" title=\"server set up\" src=\"http:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM.png\" alt=\"\" width=\"490\" height=\"237\" srcset=\"https:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM.png 490w, https:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM-300x145.png 300w, https:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM-250x120.png 250w, https:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/Screen-Shot-2012-10-11-at-1.45.03-PM-150x72.png 150w\" sizes=\"(max-width: 490px) 100vw, 490px\" \/><\/a><figcaption id=\"caption-attachment-1343\" class=\"wp-caption-text\">Two nodes connected to an array via iscsi (Ethernet)<\/figcaption><\/figure>\n<h3>The problem:<\/h3>\n<p>Updating system software is important. Keeping packages up to date protects from security vulnerabilities. Unfortunately, sometimes it breaks things. In this case, updating the suggested packages broke my set up, making it so that the Sun Storage CAM (Common Array Manager) software did not work anymore.<\/p>\n<p>I first became alerted to this when Nagios sent me errors from the script checking the StorageTek disks. I checked the command that runs in the script to see what was up, and it returned several errors. Here they are for future googlers:<\/p>\n<pre class=\"lang:bash decode:1 \" >sscs list -i 192.168.128.101 device<\/pre>\n<p> returned &#8220;Command failed due to an exception. null&#8221; and<\/p>\n<pre class=\"lang:bash decode:1 \" >sscs list -a arrayname host<\/pre>\n<p> returned &#8220;arrayname : The resource was not found.&#8221;<\/p>\n<p>Not particularly helpful messages.<\/p>\n<p>Fortunately the nodes could still mount the array partitions, which allowed them to continue running as web and mysql servers. I just couldn&#8217;t run management commands on the array.<\/p>\n<p>Since some of the required software for CAM was updated, I supposed that was causing the issue. The required software is listed below:<\/p>\n<ul>\n<li>libXtst-1.0.99.2-3.el6.i686.rpm and its dependent rpm (InstallShield requirement)<\/li>\n<li>libselinux-2.0.94-2.el6.i686.rpm<\/li>\n<li>audit-libs-2.0.4-1.el6.i686.rpm<\/li>\n<li>cracklib-2.8.16-2.el6.i686.rpm<\/li>\n<li>db4-4.7.25-16.el6.i686.rpm<\/li>\n<li>pam-1.1.1-4.el6.i686.rpm<\/li>\n<li>libstdc++-4.4.4-13.el6.i686.rpm<\/li>\n<li>zlib-1.2.3-25.el6.i686.rpm<\/li>\n<li>ksh-20100621-2.el6.x86_64.rpm<\/li>\n<\/ul>\n<p>&nbsp;<\/p>\n<h3>The solution:<\/h3>\n<p>I couldn&#8217;t figure out on my own exactly what was wrong, so I contacted Oracle support, and they finally tipped me off to the solution. Completely remove the CAM software and reinstall it. Those steps are outlined below:<\/p>\n<ul>\n<li>Go to the CAM software folder in <code>\/var\/opt\/CommonArrayManager\/Host_Software_6.9.0.16\/bin\/<\/code>and run<\/li>\n<\/ul>\n<pre class=\"lang:bash decode:1 \" >.\/uninstall -f<\/pre>\n<ul>\n<li>Here is a good spot to run <code>yum update<\/code> and restart the server if needed.<\/li>\n<li>Change directories to where you have the CAM software install CD. There should be a folder called <code>components<\/code> in there. Change into that directory and install the jdk available there:<\/li>\n<\/ul>\n<pre class=\"lang:bash decode:1 \" >rpm -Uvh jdk-6u20-linux-i586.rpm<\/pre>\n<ul>\n<li>Next run the <code>RunMe.bin<\/code> file in the CAM Software CD folder.<\/li>\n<\/ul>\n<pre class=\"lang:bash decode:1 \" >.\/RunMe.bin -c<\/pre>\n<ul>\n<li>Install the RAID Proxy Agent package located in the Add_On\/RaidArrayProxy directory of the latest CAM software distribution.<\/li>\n<\/ul>\n<pre class=\"lang:bash decode:1 \" >rpm -ivh SMruntime.xx.xx.xx.xx-xxxx.rpm<\/pre>\n<pre class=\"lang:bash decode:1 \" >rpm -ivh SMagent-LINUX-xx.xx.xx.xx-xxxx.rpm<\/pre>\n<ul>\n<li>Register the array with the host\/node. This process can take several minutes.<\/li>\n<\/ul>\n<pre class=\"lang:bash decode:1 \" >sscs register -d storage-system<\/pre>\n<p>One additional issue I ran into, was that some update or other process shutdown the NIC connecting the node to the array. I had to make sure that was running before I ran the register -d storage-system command above.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>As I&#8217;m sure many people have run into this before, and from personal experience, found nothing roaming the Interwebs on how to fix it, and seeings how I just fixed it, I&#8217;ll write up a little how to fix it post. &nbsp; The set up: Two SunFire X2100 M2 servers connected to a StorageTek 2530 &hellip; <a href=\"https:\/\/mossiso.com\/2012\/10\/11\/when-your-os-updates-break-your-cam\/\" class=\"more-link\">Continue reading <span class=\"screen-reader-text\">When  your OS updates break your CAM<\/span><\/a><\/p>\n","protected":false},"author":1,"featured_media":1353,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"jetpack_post_was_ever_published":false,"_jetpack_newsletter_access":"","_jetpack_dont_email_post_to_subs":false,"_jetpack_newsletter_tier_id":0,"footnotes":"","jetpack_publicize_message":"","jetpack_publicize_feature_enabled":true,"jetpack_social_post_already_shared":false,"jetpack_social_options":{"image_generator_settings":{"template":"highway","enabled":false}}},"categories":[167],"tags":[244],"class_list":["post-1342","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","category-technical","tag-server-admin"],"jetpack_publicize_connections":[],"jetpack_featured_media_url":"https:\/\/mossiso.com\/wp-content\/uploads\/2012\/10\/sun-cam.jpg","jetpack_sharing_enabled":true,"jetpack_shortlink":"https:\/\/wp.me\/p9wosP-lE","_links":{"self":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1342"}],"collection":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/comments?post=1342"}],"version-history":[{"count":11,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1342\/revisions"}],"predecessor-version":[{"id":1643,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/posts\/1342\/revisions\/1643"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/media\/1353"}],"wp:attachment":[{"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/media?parent=1342"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/categories?post=1342"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/mossiso.com\/wp-json\/wp\/v2\/tags?post=1342"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}