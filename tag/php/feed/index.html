<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>php &#8211; Ammon Shepherd</title>
	<atom:link href="tag/php/feed/" rel="self" type="application/rss+xml" />
	<link>https://mossiso.com</link>
	<description>mossiso = more better</description>
	<lastBuildDate>Fri, 13 Nov 2020 21:00:48 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=6.6.1</generator>

<image>
	<url>https://mossiso.com/wp-content/uploads/2018/12/favicon-96x96.png</url>
	<title>php &#8211; Ammon Shepherd</title>
	<link>https://mossiso.com</link>
	<width>32</width>
	<height>32</height>
</image> 
<site xmlns="com-wordpress:feed-additions:1">140707563</site>	<item>
		<title>Docker Development Environment for Everyone</title>
		<link>https://mossiso.com/2020/11/13/docker-development-environment-for-everyone/</link>
		
		<dc:creator><![CDATA[ammon]]></dc:creator>
		<pubDate>Fri, 13 Nov 2020 19:57:44 +0000</pubDate>
				<category><![CDATA[Coding]]></category>
		<category><![CDATA[HowTo]]></category>
		<category><![CDATA[Technical]]></category>
		<category><![CDATA[Technology]]></category>
		<category><![CDATA[Websites]]></category>
		<category><![CDATA[docker]]></category>
		<category><![CDATA[docker-compose]]></category>
		<category><![CDATA[flask]]></category>
		<category><![CDATA[local development]]></category>
		<category><![CDATA[pgadmin]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[phpMyAdmin]]></category>
		<category><![CDATA[postgres]]></category>
		<category><![CDATA[python]]></category>
		<category><![CDATA[web development]]></category>
		<guid isPermaLink="false">https://mossiso.com/?p=1875</guid>

					<description><![CDATA[One of the biggest challenges when collaborating with others in developing software and websites is setting up the development environment. The good ol &#8220;it works on my machine&#8230;&#8221; problem. Well, this is no panacea for development, but it does a good job of setting up a basic environment pretty quickly. You&#8217;re in for a special &#8230; <a href="2020/11/13/docker-development-environment-for-everyone/" class="more-link">Continue reading <span class="screen-reader-text">Docker Development Environment for Everyone</span></a>]]></description>
										<content:encoded><![CDATA[
<p>One of the biggest challenges when collaborating with others in developing software and websites is setting up the development environment. The good ol &#8220;it works on my machine&#8230;&#8221; problem.</p>



<p>Well, this is no panacea for development, but it does a good job of setting up a basic environment pretty quickly.</p>



<p>You&#8217;re in for a special treat, because I&#8217;m going to show you not one (1), but two (2) different development environments; one for PHP, MySQL, Apache and phpMyAdmin, and one for Python (Flask) and PostgreSQL with pgAdmin. Each of these in a Docker container for ease of use.</p>



<h2 class="wp-block-heading">Pre-requisites</h2>



<p>For any of this to work, make sure you have <a href="https://www.docker.com/get-started" data-type="URL" data-id="https://www.docker.com/get-              started">Docker Desktop</a> installed and running.</p>



<p>We&#8217;ll be using a terminal application for running some commands, so you&#8217;ll need some familiarity with that too.</p>



<p>Git is used to copy the files from the GitHub repo, but you can also download them as a zip file.</p>



<figure class="wp-block-image size-large"><img fetchpriority="high" decoding="async" width="1024" height="653" src="https://mossiso.com/wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-1024x653.png" alt="" class="wp-image-1882" srcset="https://mossiso.com/wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-1024x653.png 1024w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-300x191.png 300w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-768x489.png 768w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-1536x979.png 1536w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.46.50-PM-2048x1305.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">PMAMP</h2>



<p>We&#8217;ll tackle the <strong>P</strong>hp<strong>M</strong>yadmin <strong>A</strong>pache <strong>M</strong>ysql <strong>P</strong>hp (PMAMP) environment first.</p>



<p>After setting this up, we&#8217;ll have a place to put PHP code, a running Apache web server, a MySQL server and a running instance of phpMyAdmin.</p>



<p>The quickest way to get this going is to download the files from this GitHub repo <a href="https://github.com/ammonshepherd/pmamp" target="_blank" rel="noreferrer noopener">https://github.com/ammonshepherd/pmamp</a></p>



<p><code class="wp-block-code">git clone https://github.com/ammonshepherd/pmamp.git</code></p>



<p>Change into that directory.</p>



<p><code class="wp-block-code">cd pmamp</code></p>



<p>And start the Docker containers</p>



<p><code class="wp-block-code">docker-compose up -d</code></p>



<p>You can view the website at <a href="http://lvh.me">http://lvh.me</a>. lvh.me is just a nice service that points back to your local machine (127.0.0.1 or localhost). It makes it look like you are using a real domain name.</p>



<p>You can view phpMyAdmin at <a href="http://pma.lvh.me">http://pma.lvh.me</a>.</p>



<p>You can even use a real domain name. Just edit the docker-compose.yml file. There is a line like this: &nbsp;</p>



<p><code class="wp-block-code">- "traefik.http.routers.php-apache.rule=Host('lvh.me', 'pmamp.lvh.me', 'example.com')"</code></p>



<p>Just add your domain to the list (or remove the other ones). Each entry must use the backtick, rather than the single quotes. WordPress mangles the backticks, so I am using single quotes here.</p>



<p>Now you just need to let your computer know to redirect all traffic to that domain name to itself.</p>



<p>You&#8217;ll need to edit the /etc/hosts file (<a href="https://www.makeuseof.com/tag/modify-manage-hosts-file-linux/">Linux or Mac</a>), or c:\windows\system32\drivers\etc\hosts (<a href="https://www.howtogeek.com/howto/27350/beginner-geek-how-to-edit-your-hosts-file/">Windows</a>). Now you can develop for any domain name right on your computer as if it were using the actual domain name.</p>



<p>Put all of your website files in the &#8216;www&#8217; folder and you&#8217;re ready to develop!</p>



<p>Check the README at <a href="https://github.com/ammonshepherd/pmamp">https://github.com/ammonshepherd/pmamp</a> for more details on how it works and things to change.</p>



<p>To stop the services (turn off Apache, MySQL and phpAdmin) run</p>



<p><code class="wp-block-code">docker-compose down </code></p>



<p>in the same directory where the docker-compose.yml file lives.</p>



<figure class="wp-block-image size-large"><img decoding="async" width="1024" height="653" src="https://mossiso.com/wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-1024x653.png" alt="" class="wp-image-1883" srcset="https://mossiso.com/wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-1024x653.png 1024w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-300x191.png 300w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-768x489.png 768w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-1536x979.png 1536w, wp-content/uploads/2020/11/Screen-Shot-2020-11-13-at-2.43.18-PM-2048x1305.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>



<h2 class="wp-block-heading">pFp</h2>



<p>The set up for Python (using a Flask app) and PostgreSQL is exactly the same process.</p>



<p>Grab the files from <a href="https://github.com/ammonshepherd/pfp">https://github.com/ammonshepherd/pfp</a>.</p>



<p><code class="wp-block-code">git clone https://github.com/ammonshepherd/pfp.git</code></p>



<p><code class="wp-block-code">cd pfp</code></p>



<p><code class="wp-block-code">docker-compose up -d</code></p>



<p>You now have a running Flask app at <a href="http://lvh.me">http://lvh.me</a>, or <a href="http://pfp.lvh.me">http://pfp.lvh.me</a> and a running pgAdmin application at <a href="http://pga.lvh.me">http://pga.lvh.me</a>.</p>



<p>The same trick for custom domain names applies here too.</p>



<p>And also check out the README for more details: <a href="https://github.com/ammonshepherd/pfp">https://github.com/ammonshepherd/pfp</a></p>



<p>Follow the same commands above to shutdown the Python, PostgreSQL and pgAdmin containers.</p>
]]></content:encoded>
					
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">1875</post-id>	</item>
		<item>
		<title>Setting up a Hosting Environment, Part 5: Apache and PHP</title>
		<link>https://mossiso.com/2014/09/22/setting-up-a-hosting-environment-part-5-apache-and-php/</link>
		
		<dc:creator><![CDATA[ammon]]></dc:creator>
		<pubDate>Mon, 22 Sep 2014 18:13:28 +0000</pubDate>
				<category><![CDATA[Setting up a Hosting Environment]]></category>
		<category><![CDATA[Technical]]></category>
		<category><![CDATA[Technology]]></category>
		<category><![CDATA[Websites]]></category>
		<category><![CDATA[apache]]></category>
		<category><![CDATA[apache.worker]]></category>
		<category><![CDATA[apc]]></category>
		<category><![CDATA[CentOS]]></category>
		<category><![CDATA[mod_fastcti]]></category>
		<category><![CDATA[mod_fcgi]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[php-fpm]]></category>
		<guid isPermaLink="false">http://mossiso.com/?p=1426</guid>

					<description><![CDATA[Figuring out the possibilities for Apache and PHP reminds me of a Dr. Seuss book, &#8220;Fox in Sox&#8221;. It&#8217;s a favorite of mine. I love reading it to the kids. In it, Mr. Fox tries to get Mr. Knox to say all kinds of ridiculous (in meaning and hard to say) tongue twisters. At one &#8230; <a href="2014/09/22/setting-up-a-hosting-environment-part-5-apache-and-php/" class="more-link">Continue reading <span class="screen-reader-text">Setting up a Hosting Environment, Part 5: Apache and PHP</span></a>]]></description>
										<content:encoded><![CDATA[<p>Figuring out the possibilities for Apache and PHP reminds me of a Dr. Seuss book, &#8220;Fox in Sox&#8221;. It&#8217;s a favorite of mine. I love reading it to the kids. In it, Mr. Fox tries to get Mr. Knox to say all kinds of ridiculous (in meaning and hard to say) tongue twisters. At one point Mr. Knox exclaims:<br />
&#8220;I can&#8217;t blab such blibber blubber!<br />
My tongue isn&#8217;t make of rubber.&#8221;</p>
<p>That&#8217;s what my brain felt like after trying to figure all of the options for Apache and PHP. To combat my rubber brain, I created this flow-chart to help me keep track of the options, the pros and cons for each, and the path I finally chose.</p>
<p>First off, a list of requirements and goals:</p>
<ol>
<li>Chroot each vhost to it&#8217;s own directory, and have Apache and PHP run on that vhost&#8217;s server account</li>
<li>Speed, run Apache and PHP at their most effective and efficient levels</li>
<li>Utilize an opcode cache, APC, to speed up PHP pages</li>
<li>Use trusted repositories to make installation and upgrading easier</li>
</ol>
<p>Here&#8217;s what I eventually figured out about Apache and PHP:</p>
<p><figure id="attachment_1427" aria-describedby="caption-attachment-1427" style="width: 625px" class="wp-caption aligncenter"><a href="http://mossiso.com/wp-content/uploads/2013/02/ApachePHP.png"><img decoding="async" class="size-large wp-image-1427" src="http://mossiso.com/wp-content/uploads/2013/02/ApachePHP-629x1024.png" alt="ApachePHP" width="625" height="1017" srcset="https://mossiso.com/wp-content/uploads/2013/02/ApachePHP-629x1024.png 629w, https://mossiso.com/wp-content/uploads/2013/02/ApachePHP-184x300.png 184w, wp-content/uploads/2013/02/ApachePHP-250x406.png 250w, wp-content/uploads/2013/02/ApachePHP-92x150.png 92w, wp-content/uploads/2013/02/ApachePHP-624x1015.png 624w, wp-content/uploads/2013/02/ApachePHP.png 1087w" sizes="(max-width: 625px) 100vw, 625px" /></a><figcaption id="caption-attachment-1427" class="wp-caption-text">Click on the image to see a larger view</figcaption></figure></p>
<p>These sites were helpful for the initial set up of PHP as CGI with mod_fcgi and Apache in chroot (mod_fcgi sends one request to each PHP process regardless if PHP children are available to handle more, and no sharing of APC opcode cache across PHP processes):</p>
<ul>
<li><a href="http://www.howtoforge.com/how-to-set-up-apache2-with-mod_fcgid-and-php5-on-centos-5.2">http://www.howtoforge.com/how-to-set-up-apache2-with-mod_fcgid-and-php5-on-centos-5.2</a></li>
<li><a href="http://forum.linode.com/viewtopic.php?t=2982">http://forum.linode.com/viewtopic.php?t=2982</a></li>
</ul>
<p>This site was helpful for setting up PHP as CGI with mod_fastcgi and Apache in chroot (mod_fastcgi sends multiple requests to a PHP process, so the process can send them to children processes, and having one PHP process for each site allows for APC opcode cache to be usable.)</p>
<ul>
<li><a href="http://www.brandonturner.net/blog/2009/07/fastcgi_with_php_opcode_cache/">http://www.brandonturner.net/blog/2009/07/fastcgi_with_php_opcode_cache/</a></li>
</ul>
<p>These sites helped me learn about php-fpm and how it is not quite ready for what I have in mind:</p>
<ul>
<li><a href="http://www.makina-corpus.org/blog/install-drupal-php-fpm-fastcgi-apache-and-chroot-php-fpm">http://www.makina-corpus.org/blog/install-drupal-php-fpm-fastcgi-apache-and-chroot-php-fpm</a></li>
<li><a href="https://groups.google.com/forum/?fromgroups=#!topic/highload-php-en/Uq2MDrudMQ4">https://groups.google.com/forum/?fromgroups=#!topic/highload-php-en/Uq2MDrudMQ4</a></li>
</ul>
<p>I ended up going with Apache&#8217;s mod_fastcgi for using PHP as a CGI, and NOT using PHP-FPM, while running Apache in threaded mode with apache.worker enabled.</p>
<p>To get this set up is pretty easy. I already had Apache and PHP installed and running (with PHP as CGI using mod_fcgi), so here are the steps I used to convert it to run mod_fastcgi and apache.worker. I&#8217;m running CentOS 6.3.</p>
<h4>Install the RPMForge repo for installing mod_fastcgi.</h4>
<ul>
<li>Get latest from <a href="http://repoforge.org/use/">http://repoforge.org/use/</a> : <code>rpm -Uvh http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm</code></li>
<li><code>yum --enablerepo=rpmforge install mod_fastcgi</code></li>
</ul>
<h4>Edit the <code>/etc/httpd/conf/httpd.conf</code> file</h4>
<ul>
<li><code>ServerTokens Prod</code></li>
<li><code>KeepAlive On</code></li>
<li>Edit the worker section. I still need to do some testing to figure out the best configuration
<pre class="decode-attributes:false lang:apache decode:true ">&lt;IfModule worker.c&gt;
    StartServers         8
    MaxClients         300
    MinSpareThreads     25
    MaxSpareThreads     75
    ThreadsPerChild     25
    MaxRequestsPerChild  0
&lt;/IfModule&gt;</pre>
</li>
<li>If there, make sure to comment out, or delete the lines for mod_php: <code>LoadModule php5_module modules/libphp5.so</code></li>
<li>this line also: <code>AddType application/x-httpd-php .php</code></li>
<li>The last line should be: <code>Include conf/virtual_hosts.conf</code></li>
</ul>
<p>&nbsp;</p>
<h4>Create a <code>/etc/httpd/conf/virtual_hosts.conf</code> file</h4>
<p>Each virtual host needs to have an entry similar to this in the httpd.conf file, or I like to create a separate virtual_host.conf and include that in the main httpd.conf.</p>
<pre class="decode-attributes:false lang:apache decode:true"># Name-based virtual hosts
#

# Default
NameVirtualHost *:80

# Begin domain-name.com section
&lt;VirtualHost *:80&gt;
    DocumentRoot /var/domain-name/home/html/
    ServerName domain-name.com
    ServerAlias www.domain-name.com

    # Rewrite domain name to not use the 'www'
    RewriteEngine On
    RewriteCond %{HTTP_HOST}    !^domain-name\.com$ [NC]
    RewriteRule ^/(.*)  http://domain-name.com/$1 [R=301]

    # Specify where the error logs go for each domain
    ErrorLog /var/logs/httpd/current/domain-name.com-error_log
    CustomLog /var/logs/httpd/current/domain-name.com-access_log combined

    &lt;IfModule mod_fastcgi.c&gt;
        SuexecUserGroup domain-name domain-name
        ScriptAlias /cgi-bin/ "/var/www/cgi-bin/domain-name/"
        &lt;Directory "/var/domain-name/home/html"&gt;
            Options -Indexes FollowSymLinks +ExecCGI
            AddHandler php5-fastcgi .php
            Action php5-fastcgi /cgi-bin/php-fastcgi
            Order allow,deny
            Allow from all
        &lt;/Directory&gt;
    &lt;/IfModule&gt;
&lt;/VirtualHost&gt;
# End domain-name.com section</pre>
<p>Things to note:</p>
<ul>
<li>The line with <code>SuexecUserGroup</code> should have the user/group for the project.</li>
</ul>
<h4>Create the php-fastcgi file</h4>
<p>Add a <code>/var/www/cgi-bin/projectname/php-fastcgi</code> file for each project. This allows php to run as FastCGI, and use suEXEC. The php-fastcgi file needs to be under suexec’s default directory path <code>/var/www/cgi-bin/</code>.</p>
<ul>
<li>
<div>
<pre class="">#!/bin/bash
#  Set PHPRC to the path for the php.ini file. Change this to
#  /var/projectname/home/ to let projects have their own php.ini file
PHPRC=/var/domain-name/home/
export PHPRC
export PHP_FCGI_MAX_REQUESTS=5000
export PHP_FCGI_CHILDREN=5
exec /usr/bin/php-cgi</pre>
</div>
</li>
</ul>
<p>Things to note:</p>
<ul>
<li>The directory and file created above must be have user/group of the project (the same as the user/group of the /var/projectname/ directory)</li>
<li>The directory and file must be executable and writable by the owner ONLY.</li>
<li>If you get Apache Internal Server errors, check <code>/var/log/httpd/suexec.log</code></li>
<li>For each site, you can specify how much RAM the APC module can use. For large, busy sites, you set this higher. Not setting this defaults to 64MB, which is a bit more than needed for the average WP site. Change the last line in the <code>/var/www/cgi-bin/projectname/php-fastcgi</code> file:
<ul>
<li><code>exec /usr/bin/php-cgi -d apc.shm_size=128M</code></li>
</ul>
</li>
</ul>
<h4>Change php.conf</h4>
<p>Comment out everything in the <code>/etc/httpd/conf.d/php.conf</code> file so php is not loaded as a module when Apache starts.</p>
<h4>Apache multi-threaded</h4>
<p>Edit the <code>/etc/sysconfig/httpd</code> file to allow Apache to use multi-threaded mode (httpd.worker) which handles basic HTML files much nicer (less RAM). Uncomment the line with <code>HTTPD=/usr/sbin/httpd.worker</code></p>
<h4>Config Check</h4>
<p>Check the Apache configuration files to see if there are any errors.</p>
<ul>
<li><code>service httpd configtest</code></li>
</ul>
<p>If all good, restart Apache</p>
<ul>
<li><code>service httpd restart</code> This will stop the running httpd service, and then start it again. Use this command after installing or removing a dynamically loaded module such as PHP. OR</li>
<li><code>service httpd reload</code> This will cause the running httpd service to reload the configuration file. Note that any requests being currently processed will be interrupted, which may cause a client browser to display an error message or render a partial page. OR</li>
<li><code>service httpd graceful</code> This will cause the running httpd service to reload the configuration file. Note that any requests being currently processed will use the old configuration.</li>
</ul>
<h3>Install APC</h3>
<ul>
<li><code>pecl install apc</code></li>
</ul>
<p>Set up log rotation for Apache</p>
<ul>
<li>Add a file <code>/etc/logrotate.d/httpd.monti</code></li>
<li>
<div>
<pre class="decode-attributes:false lang:apache decode:true">/var/logs/httpd/*log {
    daily
    rotate 365
    compress
    missingok
    notifempty
    copytruncate
    olddir /var/logs/httpd/archives/
    sharedscripts
    postrotate
        /bin/kill -HUP `cat /var/run/httpd/httpd.pid 2&gt;/dev/null` 2&gt; /dev/null || true
    endscript
}</pre>
</div>
</li>
</ul>
]]></content:encoded>
					
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">1426</post-id>	</item>
		<item>
		<title>Multiple PHP Instances With One Apache</title>
		<link>https://mossiso.com/2009/09/02/multiple-php-instances-with-one-apache/</link>
					<comments>https://mossiso.com/2009/09/02/multiple-php-instances-with-one-apache/#comments</comments>
		
		<dc:creator><![CDATA[ammon]]></dc:creator>
		<pubDate>Wed, 02 Sep 2009 21:12:02 +0000</pubDate>
				<category><![CDATA[Coding]]></category>
		<category><![CDATA[HowTo]]></category>
		<category><![CDATA[Technical]]></category>
		<category><![CDATA[apache]]></category>
		<category><![CDATA[bash code]]></category>
		<category><![CDATA[CentOS]]></category>
		<category><![CDATA[httpd]]></category>
		<category><![CDATA[LAMP]]></category>
		<category><![CDATA[mysql]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[tutorial]]></category>
		<guid isPermaLink="false">http://historicalwebber.mossiso.com/?p=311</guid>

					<description><![CDATA[&#160; Long-winded Introduction It took me a couple of days to figure this out due to lack of decent tutorials and not enough confidence in my Linux skills to build programs from source. I think I have the hang of it now, and write this up with the intent on providing another, or the only, &#8230; <a href="2009/09/02/multiple-php-instances-with-one-apache/" class="more-link">Continue reading <span class="screen-reader-text">Multiple PHP Instances With One Apache</span></a>]]></description>
										<content:encoded><![CDATA[<p>&nbsp;</p>
<h3>Long-winded Introduction</h3>
<p>It took me a couple of days to figure this out due to lack of decent tutorials and not enough confidence in my Linux skills to build programs from source. I think I have the hang of it now, and write this up with the intent on providing another, or the only, tutorial on setting up CentOS 5 with multiple instances of PHP using one Apache install. That being said, there are a number of good tutorials out there, just none of them explicitly for CentOS and some leave out some details that n00bs like me get confused about.</p>
<p><a href="http://www.aditus.nu/jpgraph/apache2suse10.php">PHP4 and PHP5 on SuSE 10.1</a> &#8211; This was by far the most helpful of the tutorials. Even though it was written for SuSE, it works almost straight across for CentOS.</p>
<p>There is also a great list of instructions in the comments on the php.net site under installing PHP for Apache 2.0 on Unix systems (see <a href="http://www.php.net/manual/en/install.unix.apache2.php#90478">http://www.php.net/manual/en/install.unix.apache2.php#90478</a>).</p>
<p>I found this one after I wrote up this tutorial at <a href="http://cuadradevelopment.com/blog/26/multiple-php-versions-with-apache-using-fastcgi-on-os-x/">http://cuadradevelopment.com</a>. It&#8217;s a bit different, but should work as well.</p>
<p>There are basically two different ways I could have done this. 1- run a single instance of Apache, and run one instance of PHP as a module, and other installs as CGI. 2- run several instances of Apache, each with it&#8217;s own instance of PHP as a module. I chose to do the first method for no particular reason. <a href="http://blog.dreamhosters.com/kbase/index.cgi?area=2933">Dreamhost</a> has a post about the good and bad with running PHP as CGI.</p>
<p>So basically, the steps are: 1. Set up Apache and have PHP install as a module. 2. Configure and make another instance of PHP to run as CGI. 3. Add a virtual host to Apache running under a different port to access the PHP as CGI.<br />
<span id="more-311"></span></p>
<h3>Set up Apache with PHP module</h3>
<p>So here&#8217;s what I did to get the basic Apache, PHP and MySQL working. This sets up the first PHP install to run as a module in Apache:</p>
<p>From a clean install of CentOS 5 (virtually no packages selected during initial install), I installed the following packages:</p>
<p><code>$ yum install gcc make subversion ImageMagick php php-cli php-common php-ldap php-mysql php-pdo php-pear php-devel bzip2-devel libxml2-devel mysql mysql-server mysql-devel mod_auth_mysql httpd httpd-manual</code></p>
<p>From there I needed to get PHP 5.2.x, so I did the following to get PHP, Apache, MySQL and PEAR all set up.</p>
<ol>
<li><strong>Step 1:</strong> GET PHP 5.2.x<br />
Check out instructions and packages here: <a href="http://blog.famillecollet.com/pages/Config-en">http://blog.famillecollet.com/pages/Config-en</a></p>
<pre>$ wget http://download.fedora.redhat.com/pub/epel/5/i386/epel-release-5-2.noarch.rpm
$ wget http://rpms.famillecollet.com/el5.i386/remi-release-5-4.el5.remi.noarch.rpm
$ rpm -Uvh remi-release-5<strong>.rpm epel-release-5</strong>.rpm
$ yum—enablerepo=remi update php-pear php</pre>
<p>Copy the /etc/php.ini file from the /etc/php.ini.default:</p>
<pre>$ cp /etc/php.ini.default /etc/php.ini</pre>
<p>Change the following lines:</p>
<ul>
<li>1. upload_max_filesize = 20M #line 573</li>
<li>2. mysql.default_socket =/path/to/mysql/mysql.sock #about line 736</li>
<li>3. mysqli.default_socket =/path/to/mysql/mysql.sock #about line 771</li>
</ul>
</li>
<li><strong>Step 2:</strong>Edit /etc/httpd/conf/httpd.conf by changing the following lines
<ul>
<li>1. Listen xxx.xxx.xxx.xxx:80 #line 134</li>
<li>2. ServerAdmin admin@email.org #line 251</li>
<li>3. ServerName somesite.org #line 265</li>
<li>4. DocumentRoot ”/path/to/htdocs” #line 282</li>
<li>5. &lt;Directory ”/path/to/htdocs”&gt; #line 307</li>
<li>6. AllowOverride All #line 328</li>
<li>7. DirectoryIndex index.php index.html index.html.var #line 392</li>
</ul>
</li>
<li><strong>Step 3:</strong> Create the /etc/my.cnf file for MySQL<br />
[code]</p>
<pre>[mysqld]
datadir=/path/to/mysql
socket=/path/to/mysql/mysql.sock
user=mysql
# Default to using old password format for compatibility with mysql 3.x
# clients (those using the mysqlclient10 compatibility package).
old_passwords=1

[client]
socket=/path/to/mysql/mysql.sock

[mysqld_safe]
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid</pre>
<p>[/code]</li>
<li><strong>Step 4:</strong> Start apache and mysql and set them to start on boot up:<br />
<blockquote>
<pre>$ service httpd start
$ service mysqld start
$ chkconfig mysqld on
$ chkconfig httpd on</pre>
</blockquote>
</li>
<li><strong>Step 5:</strong> Set the MySQL password for root<br />
<blockquote>
<pre>$ mysqladmin -u root password ‘XXXXXX’</pre>
</blockquote>
</li>
<li><strong>Step 6:</strong> install Phing and other PEAR packages<br />
<blockquote>
<pre>$ pear channel-discover pear.phing.info
$ pear channel-discover pear.phpunit.de
$ pear install phing/phing
$ pear install PhpDocumentor
$ pear install XML_Beautifier
$ pear install PHPUnit
$ pecl install Xdebug</pre>
</blockquote>
</li>
</ol>
<h3>Configure second version of PHP</h3>
<p>From here we need to install a second version of PHP. Grab the version you want from <a href="http://www.php.net/releases/">http://www.php.net/releases/</a>, and stick that any where you want to (usually your root&#8217;s home directory is fine). I&#8217;m installing PHP 5.2.4, so I&#8217;ll use that in my examples.</p>
<p>Unpack the tarball and enter the directory it created.</p>
<pre>$ tar -xjf php-5.2.4.tar.bz2</pre>
<p>Now, you&#8217;ll need to determine which modules you need to install. For this part I used the steps from the php.net comment under &#8220;my approach for determining required modules&#8221; (copied here, without permission, but with lots of gratitude and full credit going to the author of the comment).</p>
<pre>my approach for determining required modules
------------------------------------
1. get the list of the modules
     $  php -m | grep -v -e Modules] -e ^$ &gt; php-default-modules

2. create the configure script
$  for i in $(cat php-default-modules); do echo -n "--with-$i "&gt;&gt; phpconfigure.sh ;done

     2.2 add #!/bin/bash to the top line, and ./configure to the second line.
          Each of the --with-* need to be on the second line.

3. run the configure script, and iterate through the "Configure script errors"
    section below until it completes properly

    $ ./phpconfigure.sh

4. at the end of the output, look for a notice of unknown options

     Notice: Following unknown configure options were used:
     --with-date
     --with-gum-disease

     Check './configure --help' for available options

5. as suggested, execute '$ ./configure --help' and correct the options. The
     "for" command above indiscriminately inserts "--with-" for all modules,
     but bundled modules may require "--enable-" instead, so mostly you'll
     be changing those. For modules that are enabled by default you'll need
     to remove the entry.

6. Add anything else you personally want or need. I like to add "--enable-safe-mode".</pre>
<p>After doing all of that, I had the following in phpconfigure.sh<br />
[code lang=&#8221;bash&#8221;]<br />
#!/bin/bash<br />
./configure &#8211;prefix=/usr/share/ &#8211;datadir=/usr/share/php &#8211;libdir=/usr/share &#8211;includedir=/usr/include &#8211;bindir=/usr/bin &#8211;enable-safe-mode &#8211;with-config-file-path=/etc/php542 &#8211;enable-force-cgi-redirect &#8211;enable-discard-path &#8211;with-bz2 &#8211;enable-calendar &#8211;with-curl &#8211;enable-dbase &#8211;enable-exif &#8211;enable-ftp &#8211;with-gettext &#8211;with-gmp &#8211;with-iconv &#8211;with-ldap &#8211;with-libxml-dir=/usr/lib/ &#8211;enable-mbstring &#8211;with-mime_magic &#8211;with-mysql &#8211;with-mysqli &#8211;with-openssl &#8211;enable-pcntl &#8211;with-pcre-dir=/usr/lib/ &#8211;with-pdo_mysql &#8211;with-pdo_sqlite &#8211;with-readline &#8211;enable-shmop &#8211;enable-sockets &#8211;with-SQLite &#8211;enable-wddx &#8211;with-xsl &#8211;enable-zip &#8211;with-zlib</p>
<p># Changes from what php -m spits out. You don&#8217;t need the info below in your phpconfigure.sh script<br />
#&#8211;enable-calendar<br />
#&#8211;with-ctype # default<br />
#&#8211;with-date # not found, default?<br />
#&#8211;enable-dbase<br />
#&#8211;with-dom # default<br />
#&#8211;enable-exif<br />
#&#8211;with-filter #default<br />
#&#8211;with-ftp<br />
#&#8211;with-hash #default<br />
#&#8211;with-json #default<br />
#&#8211;with-libxml-dir=/usr/lib/<br />
#&#8211;enable-mbstring<br />
#&#8211;with-memcache #not found, default?<br />
#&#8211;enable-pcntl<br />
#&#8211;with-pcre-dir=/usr/lib/<br />
#&#8211;with-PDO #taken care of with the pdo_mysql and pdo_sqlite<br />
#&#8211;with-Reflection #default<br />
#&#8211;with-session #default<br />
#&#8211;enable-shmop<br />
#&#8211;with-SimpleXML #default<br />
#&#8211;enable-sockets<br />
#&#8211;with-SPL #default<br />
#&#8211;with-standard #not found, is it SPL? default?<br />
#&#8211;with-tokenizer #default<br />
#&#8211;enable-wddx<br />
#&#8211;with-xdebug #not found, not needed<br />
#&#8211;with-xml #default<br />
#&#8211;with-xmlreader #default<br />
#&#8211;with-xmlwriter #default<br />
#&#8211;enable-zip<br />
#&#8211;with-Xdebug #not found, not needed</p>
<p>[/code]</p>
<p><strong>NOTE:</strong> make sure you do not include &#8216;&#8211;with-apxs2=/usr/sbin/apxs&#8217;. This is what installs PHP as an Apache module. Also, since you have the original PHP running, you can theoretically make a phpinfo file (with phpinfo() ) in it, and grab the configure entries from that, making sure to change &#8216;&#8211;with-config-file-path=/etc&#8217; &#8216;&#8211;with-config-file-scan-dir=/etc/php.d&#8217;</p>
<p>During the configure, you might run into some errors. Again from the php.net comment:</p>
<pre>Configure script errors
--------------------------------------------
In my experience, these errors have been due (with any software, PHP included) mostly to missing
development packages, which contain the libraries and headers needed to compile support for that
library's function into the application.

This becomes a process of:
-executing the ./configure script and looking at the error
-installing the devel package providing the resource referenced by the error (google using the error
     as search term as needed)
-repeat until the ./configure script makes it through without error

Upshot: identify the software referenced by the error, and install it.

Example
-----------
Example error:
     configure: error: Cannot find OpenSSL's
Example explanation
     configure is looking for a header (and probably a lot of other stuff) from a missing openssl package.
Example solution:
php-5.2.9]$sudo yum install openssl-devel</pre>
<p>The previous yum command should take care of most of those dependencies.</p>
<p>After the phpconfigure script runs without errors, then simply run</p>
<pre>$ make</pre>
<p>As the JpGraph tutorial explains, there is no need to run &#8220;make install&#8221;. Just simply copy the php-cgi executable to the proper place. We&#8217;ll get to that step shortly.</p>
<h3>Set up Apache VirtualHost and website directories</h3>
<p>Now you need to create two directories to handle the PHP as CGI. They can be virtually wherever, but should be in the same directory where you have the main html content. So if you set the path to the website data (in the httpd.conf) to /path/to/htdocs/, then you&#8217;ll need to make a /path/to/php524/ and a /path/to/php524-cgi/</p>
<pre>$ mkdir /path/to/php524/</pre>
<p>and</p>
<pre>$ mkdir /path/to/php524-cgi/</pre>
<p>After you have those directories, you can add the VirtualHost information to the Apache config (httpd.conf). I like to have a separate file for the VirtualHosts, so I added this to the end of the httpd.conf file.</p>
<pre>Include conf/XXXXX_vhosts.conf</pre>
<p>And to allow VirtualHosts, uncomment this line:</p>
<pre>NameVirtualHost *:80</pre>
<p>To allow Apache to listen on (or accept requests from) different ports besides the default 80, add another Listen line to the httpd.conf file:</p>
<pre>Listen XXX.XXX.XXX.XXX:8524</pre>
<p>I used port 8524 to correspond to version 5.2.4 of PHP</p>
<p>Now create the XXXXX_vhosts.conf file</p>
<p>[code lang=&#8221;bash&#8221;]<br />
#this doesn&#8217;t really seem to be needed, but it&#8217;s there<br />
NameVirtualHost *:8524</p>
<p># this is the original and runs the PHP as a module</p>
<p>DocumentRoot /path/to/htdocs/<br />
ServerName somesite.org</p>
<p>####### Add other Virtual Hosts below here #######</p>
<p># Setup PHP 5.2.4 on port 8524</p>
<p>DocumentRoot /path/to/php524/<br />
# We use a separate CGI directory<br />
ScriptAlias /cgi-bin/ /path/to/php524-cgi/</p>
<p># These are the two critical statements for this virtual<br />
# host. This activates PHP 5.2.4 as a CGI module<br />
Action php524-cgi /cgi-bin/php-cgi<br />
AddHandler php524-cgi .php5 .php</p>
<p>#Options None<br />
Options FollowSymLinks<br />
#AllowOverride None<br />
AllowOverride All<br />
Order allow,deny<br />
Allow from all<br />
# For good measure we also add recognition of PHP5 index<br />
DirectoryIndex index.html index.php index.php5</p>
<p>[/code]</p>
<p>Now, you need to copy the php-cgi binary/executable to the /path/to/php524-cgi/ directory. The php-cgi file is located in the file where you ran the configure and make for the new php install. So if you did all that in the /opt/php-5.2.4/ directory, the php-cgi will be located at /opt/php-5.2.4/sapi/cgi/php-cgi.</p>
<pre>$ cp /opt/php-5.2.4/sapi/cgi/php-cgi /path/to/php524-cgi/</pre>
<p>Finally, copy the php.ini file to the right place. And configure as needed.</p>
<pre>$ cp /opt/php-5.2.4/php.ini-dist /path/to/php524-cgi/php.ini</pre>
<p>Test the apache configs to make sure they work:</p>
<pre>$ /usr/sbin/apachectl configtest</pre>
<p>If that returns OK restart Apache.</p>
<pre>$ /etc/init.d/httpd graceful</pre>
<p>You can make a phpinfo page to test that it&#8217;s using the new PHP version.<br />
[code lang=&#8221;php&#8221;]<br />
&lt; ?php<br />
phpinfo();<br />
? &gt;<br />
[/code]<br />
Then check out your new site: http://somesite.org:8524/phpinfo.php</p>
<p>In order to get the different versions of PHP to interact with MySQL, you&#8217;ll have to use the URL on port 80 as the MySQL host. So, for example, in a WordPress install at http://somesite.org:8524/blog, the wp-config.php will have to have the following for the MySQL hostname:</p>
<pre>define('DB_HOST', 'dev.omeka.org');</pre>
<p>There is some issue with mod_rewrite on the different versions of PHP. I&#8217;ll replace this paragraph with a fix when I have one.<br />
UPDATE: 9/9/09 &#8211; I figured out how to get the .htaccess working for the <a href="http://omeka.org">Omeka</a> installs we were working with. I needed to change the AllowOverride lines in the vhost.conf (or httpd.conf) file from None, to All.</p>
<p>Well, there you go. Hope that&#8217;s enough detail to get you going.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://mossiso.com/2009/09/02/multiple-php-instances-with-one-apache/feed/</wfw:commentRss>
			<slash:comments>4</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">311</post-id>	</item>
	</channel>
</rss>
